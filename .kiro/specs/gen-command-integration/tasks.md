# Implementation Plan

## Task Overview

gen コマンドに type-extractor、resolver-extractor、schema-generator を統合し、TypeScript ソースコードから GraphQL スキーマと resolver マップを生成してファイルに出力する機能を実装する。

## Tasks

- [x] 1. 進捗表示機能の実装
- [x] 1.1 (P) フェーズ表示機能を構築する
  - 処理フェーズの開始時にフェーズ名を表示する機能を実装する
  - 型抽出、リゾルバ抽出、スキーマ生成の各フェーズ名を定義する
  - フェーズ完了時の完了メッセージ表示を実装する
  - _Requirements: 7.1_

- [x] 1.2 (P) ファイル出力通知機能を構築する
  - ファイル書き込み完了時に出力パスを表示する機能を実装する
  - 出力メッセージのフォーマットを定義する
  - _Requirements: 7.2_

- [x] 2. 診断メッセージ表示機能の実装
- [x] 2.1 (P) 診断メッセージのフォーマッタを構築する
  - エラーと警告を分類して表示する機能を実装する
  - ファイル名、行番号、列番号を含む位置情報のフォーマットを定義する
  - 診断コードに基づくメッセージテンプレートを作成する
  - エラーは標準エラー出力、その他は標準出力に出力する
  - _Requirements: 6.1, 6.3_

- [x] 2.2 (P) 成功・失敗メッセージを構築する
  - 処理成功時のメッセージ表示機能を実装する
  - 処理失敗時のエラーサマリー表示機能を実装する
  - _Requirements: 6.4_

- [x] 3. ファイル書き込み機能の実装
- [x] 3.1 (P) ディレクトリ作成とファイル書き込み機能を構築する
  - 出力ディレクトリが存在しない場合に自動作成する機能を実装する
  - ネストされたディレクトリ構造にも対応する
  - 生成されたコードをファイルに書き出す機能を実装する
  - 複数ファイルの一括書き込みをサポートする
  - 既存ファイルの上書き更新を実装する
  - 書き込みエラー時の適切なエラーハンドリングを実装する
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 4. パイプラインオーケストレーションの実装
- [x] 4.1 ディレクトリスキャン機能を構築する
  - 規約に基づいた types ディレクトリのパス解決を実装する
  - 規約に基づいた resolvers ディレクトリのパス解決を実装する
  - ディレクトリ内の TypeScript ファイルのみをスキャン対象とする
  - ディレクトリ不在時のエラーハンドリングを実装する
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 4.2 型抽出とリゾルバ抽出の統合を構築する
  - type-extractor を呼び出して型情報を抽出する機能を実装する
  - resolver-extractor を呼び出してリゾルバペアを抽出する機能を実装する
  - 抽出結果と診断メッセージを収集する
  - _Requirements: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3_

- [x] 4.3 スキーマ生成の統合を構築する
  - 型とリゾルバの抽出結果を統合する
  - schema-generator を呼び出してコードを生成する機能を実装する
  - typeDefs コードと resolvers コードを取得する
  - _Requirements: 4.1, 4.2, 4.3_

- [x] 4.4 エラー判定と終了コード制御を構築する
  - 収集した診断メッセージからエラー有無を判定する
  - 重大なエラー時はファイル出力をスキップする制御を実装する
  - エラー有無に応じた終了コードを返す機能を実装する
  - _Requirements: 6.2, 6.5_

- [x] 5. gen コマンドへの統合
  - オーケストレーターを gen コマンドに接続する
  - gunshi の define() を使用したコマンド定義を更新する
  - 進捗表示と診断メッセージ表示を組み込む
  - ファイル出力処理を組み込む
  - _Requirements: 1.1, 1.2, 2.1, 3.1, 4.1, 5.1, 6.1, 7.1_

- [x] 6. 統合テストの実装
- [x] 6.1 正常系パイプラインテストを構築する
  - types と resolvers を含むテストフィクスチャを準備する
  - 完全なパイプライン実行のテストを実装する
  - 生成された schema.ts と resolvers.ts の内容を検証する

- [x] 6.2 エラー系パイプラインテストを構築する
  - ディレクトリ不在時の動作を検証するテストを実装する
  - 型エラー発生時の動作を検証するテストを実装する
  - リゾルバ不整合時の動作を検証するテストを実装する

- [x] 7. E2E テストの実装
  - 実際の gqlkit gen コマンド実行テストを実装する
  - 成功時と失敗時の終了コードを検証する
  - 生成された TypeScript ファイルのコンパイル検証を実装する
